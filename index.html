<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>MoneyTrack Pro - Quản lý nợ chuyên nghiệp</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/toastify-js/src/toastify.min.css">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdn.sheetjs.com/xlsx-0.19.3/package/dist/xlsx.full.min.js"></script>
  <style>
    :root {
      --primary: #4361ee;
      --primary-light: #eef2ff;
      --secondary: #3f37c9;
      --success: #4cc9f0;
      --success-light: #e6f7fd;
      --danger: #f72585;
      --danger-light: #fde8ef;
      --warning: #f8961e;
      --info: #4895ef;
      --light: #f8f9fa;
      --dark: #212529;
      --gray: #6c757d;
      --gray-light: #e9ecef;
      --sidebar-width: 280px;
      --header-height: 70px;
      --transition: all 0.3s ease;
    }
    
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    body {
      font-family: 'Poppins', sans-serif;
      background-color: #f5f7fa;
      color: var(--dark);
      line-height: 1.6;
      overflow-x: hidden;
    }
    
    /* Login Screen */
    .login-container {
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
      background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
      padding: 20px;
    }
    
    .login-card {
      background: white;
      border-radius: 15px;
      width: 100%;
      max-width: 450px;
      padding: 40px;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
      transform: translateY(0);
      opacity: 1;
      transition: var(--transition);
    }
    
    .login-card.hidden {
      transform: translateY(20px);
      opacity: 0;
    }
    
    .login-logo {
      text-align: center;
      margin-bottom: 30px;
    }
    
    .login-logo i {
      font-size: 3rem;
      color: var(--primary);
      margin-bottom: 15px;
    }
    
    .login-logo h1 {
      font-size: 1.8rem;
      color: var(--dark);
    }
    
    .form-group {
      margin-bottom: 1.5rem;
      position: relative;
    }
    
    .form-group label {
      display: block;
      margin-bottom: 0.5rem;
      font-weight: 500;
      color: var(--dark);
    }
    
    .form-control {
      width: 100%;
      padding: 12px 15px;
      border: 1px solid var(--gray-light);
      border-radius: 8px;
      font-size: 1rem;
      transition: var(--transition);
    }
    
    .form-control:focus {
      outline: none;
      border-color: var(--primary);
      box-shadow: 0 0 0 3px rgba(67, 97, 238, 0.2);
    }
    
    .btn {
      padding: 12px 20px;
      border: none;
      border-radius: 8px;
      font-weight: 500;
      cursor: pointer;
      transition: var(--transition);
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
    }
    
    .btn-block {
      display: block;
      width: 100%;
    }
    
    .btn-primary {
      background-color: var(--primary);
      color: white;
    }
    
    .btn-primary:hover {
      background-color: var(--secondary);
      transform: translateY(-2px);
      box-shadow: 0 5px 15px rgba(67, 97, 238, 0.3);
    }
    
    /* Main App */
    .app-container {
      display: none;
    }
    
    .app-container.active {
      display: block;
    }
    
    /* Sidebar */
    .sidebar {
      position: fixed;
      top: 0;
      left: 0;
      width: var(--sidebar-width);
      height: 100vh;
      background: white;
      box-shadow: 2px 0 10px rgba(0, 0, 0, 0.05);
      z-index: 100;
      transition: var(--transition);
      transform: translateX(0);
    }
    
    .sidebar-header {
      padding: 20px;
      border-bottom: 1px solid var(--gray-light);
      height: var(--header-height);
      display: flex;
      align-items: center;
    }
    
    .sidebar-logo {
      display: flex;
      align-items: center;
      gap: 10px;
      font-size: 1.3rem;
      font-weight: 600;
      color: var(--primary);
    }
    
    .sidebar-logo i {
      font-size: 1.8rem;
    }
    
    .sidebar-menu {
      padding: 20px 0;
    }
    
    .menu-item {
      display: flex;
      align-items: center;
      padding: 12px 20px;
      color: var(--gray);
      text-decoration: none;
      transition: var(--transition);
      border-left: 3px solid transparent;
    }
    
    .menu-item i {
      margin-right: 12px;
      font-size: 1.1rem;
      width: 20px;
      text-align: center;
    }
    
    .menu-item:hover {
      color: var(--primary);
      background-color: var(--primary-light);
    }
    
    .menu-item.active {
      color: var(--primary);
      background-color: var(--primary-light);
      border-left: 3px solid var(--primary);
      font-weight: 500;
    }
    
    /* Main Content */
    .main-content {
      margin-left: var(--sidebar-width);
      padding-top: var(--header-height);
      transition: var(--transition);
    }
    
    /* Header */
    .main-header {
      position: fixed;
      top: 0;
      right: 0;
      left: var(--sidebar-width);
      height: var(--header-height);
      background: white;
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 0 25px;
      z-index: 90;
      transition: var(--transition);
    }
    
    .header-left {
      display: flex;
      align-items: center;
    }
    
    .toggle-sidebar {
      background: none;
      border: none;
      font-size: 1.3rem;
      color: var(--gray);
      cursor: pointer;
      margin-right: 20px;
      transition: var(--transition);
    }
    
    .toggle-sidebar:hover {
      color: var(--primary);
    }
    
    .header-right {
      display: flex;
      align-items: center;
    }
    
    .user-dropdown {
      position: relative;
    }
    
    .user-btn {
      display: flex;
      align-items: center;
      background: none;
      border: none;
      cursor: pointer;
    }
    
    .user-avatar {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      background-color: var(--primary);
      color: white;
      display: flex;
      align-items: center;
      justify-content: center;
      margin-right: 10px;
      font-weight: 500;
    }
    
    .user-name {
      font-weight: 500;
      margin-right: 8px;
    }
    
    .dropdown-menu {
      position: absolute;
      top: 100%;
      right: 0;
      background: white;
      border-radius: 8px;
      box-shadow: 0 5px 20px rgba(0, 0, 0, 0.1);
      width: 200px;
      padding: 10px 0;
      opacity: 0;
      visibility: hidden;
      transform: translateY(10px);
      transition: var(--transition);
      z-index: 110;
    }
    
    .user-dropdown:hover .dropdown-menu {
      opacity: 1;
      visibility: visible;
      transform: translateY(0);
    }
    
    .dropdown-item {
      display: block;
      padding: 10px 20px;
      color: var(--dark);
      text-decoration: none;
      transition: var(--transition);
    }
    
    .dropdown-item:hover {
      background-color: var(--primary-light);
      color: var(--primary);
    }
    
    .dropdown-divider {
      height: 1px;
      background-color: var(--gray-light);
      margin: 8px 0;
    }
    
    /* Page Content */
    .page-content {
      padding: 25px;
    }
    
    .page-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 25px;
    }
    
    .page-title {
      font-size: 1.5rem;
      font-weight: 600;
      color: var(--dark);
    }
    
    .page-actions {
      display: flex;
      gap: 10px;
    }
    
    /* Dashboard */
    .stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
      gap: 20px;
      margin-bottom: 30px;
    }
    
    .stat-card {
      background: white;
      border-radius: 12px;
      padding: 20px;
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
      transition: var(--transition);
    }
    
    .stat-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
    }
    
    .stat-card.primary {
      border-top: 4px solid var(--primary);
    }
    
    .stat-card.success {
      border-top: 4px solid var(--success);
    }
    
    .stat-card.danger {
      border-top: 4px solid var(--danger);
    }
    
    .stat-card.warning {
      border-top: 4px solid var(--warning);
    }
    
    .stat-title {
      font-size: 0.9rem;
      color: var(--gray);
      margin-bottom: 10px;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    
    .stat-value {
      font-size: 1.8rem;
      font-weight: 600;
      margin-bottom: 5px;
    }
    
    .stat-change {
      font-size: 0.85rem;
      display: flex;
      align-items: center;
      gap: 5px;
    }
    
    .stat-change.up {
      color: var(--success);
    }
    
    .stat-change.down {
      color: var(--danger);
    }
    
    .chart-container {
      background: white;
      border-radius: 12px;
      padding: 20px;
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
      margin-bottom: 30px;
    }
    
    .chart-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
    }
    
    .chart-title {
      font-size: 1.1rem;
      font-weight: 500;
    }
    
    /* Debts Table */
    .table-container {
      background: white;
      border-radius: 12px;
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
      overflow: hidden;
    }
    
    .table-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 20px;
      border-bottom: 1px solid var(--gray-light);
    }
    
    .table-title {
      font-size: 1.1rem;
      font-weight: 500;
    }
    
    .table-actions {
      display: flex;
      gap: 10px;
    }
    
    .table-responsive {
      overflow-x: auto;
    }
    
    table {
      width: 100%;
      border-collapse: collapse;
    }
    
    th, td {
      padding: 15px 20px;
      text-align: left;
      border-bottom: 1px solid var(--gray-light);
    }
    
    th {
      font-weight: 500;
      color: var(--gray);
      background-color: var(--light);
    }
    
    tr:hover {
      background-color: var(--light);
    }
    
    .badge {
      display: inline-block;
      padding: 5px 10px;
      border-radius: 20px;
      font-size: 0.75rem;
      font-weight: 500;
      text-transform: uppercase;
    }
    
    .badge-success {
      background-color: var(--success-light);
      color: var(--success);
    }
    
    .badge-danger {
      background-color: var(--danger-light);
      color: var(--danger);
    }
    
    .action-btn {
      background: none;
      border: none;
      cursor: pointer;
      color: var(--gray);
      transition: var(--transition);
      padding: 5px;
      border-radius: 5px;
    }
    
    .action-btn:hover {
      color: var(--primary);
      background-color: var(--primary-light);
    }
    
    .action-btn.delete:hover {
      color: var(--danger);
      background-color: var(--danger-light);
    }
    
    /* Modal */
    .modal {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0, 0, 0, 0.5);
      display: flex;
      justify-content: center;
      align-items: center;
      z-index: 1000;
      opacity: 0;
      visibility: hidden;
      transition: var(--transition);
    }
    
    .modal.active {
      opacity: 1;
      visibility: visible;
    }
    
    .modal-content {
      background-color: white;
      width: 90%;
      max-width: 600px;
      border-radius: 12px;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
      transform: translateY(-20px);
      transition: var(--transition);
      max-height: 90vh;
      overflow-y: auto;
    }
    
    .modal.active .modal-content {
      transform: translateY(0);
    }
    
    .modal-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 20px;
      border-bottom: 1px solid var(--gray-light);
    }
    
    .modal-title {
      font-size: 1.3rem;
      font-weight: 500;
    }
    
    .close-btn {
      background: none;
      border: none;
      font-size: 1.5rem;
      cursor: pointer;
      color: var(--gray);
      transition: var(--transition);
    }
    
    .close-btn:hover {
      color: var(--danger);
    }
    
    .modal-body {
      padding: 20px;
    }
    
    .modal-footer {
      padding: 15px 20px;
      border-top: 1px solid var(--gray-light);
      display: flex;
      justify-content: flex-end;
      gap: 10px;
    }
    
    /* Form Elements */
    .form-row {
      display: flex;
      gap: 20px;
      margin-bottom: 20px;
    }
    
    .form-col {
      flex: 1;
    }
    
    .input-group {
      position: relative;
    }
    
    .input-group .form-control {
      padding-left: 40px;
    }
    
    .input-icon {
      position: absolute;
      left: 15px;
      top: 50%;
      transform: translateY(-50%);
      color: var(--gray);
    }
    
    .switch-container {
      display: flex;
      align-items: center;
      gap: 15px;
      margin: 15px 0;
    }
    
    .switch {
      position: relative;
      display: inline-block;
      width: 60px;
      height: 34px;
    }
    
    .switch input {
      opacity: 0;
      width: 0;
      height: 0;
    }
    
    .slider {
      position: absolute;
      cursor: pointer;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background-color: var(--danger);
      transition: var(--transition);
      border-radius: 34px;
    }
    
    .slider:before {
      position: absolute;
      content: "";
      height: 26px;
      width: 26px;
      left: 4px;
      bottom: 4px;
      background-color: white;
      transition: var(--transition);
      border-radius: 50%;
    }
    
    input:checked + .slider {
      background-color: var(--success);
    }
    
    input:checked + .slider:before {
      transform: translateX(26px);
    }
    
    /* Responsive */
    @media (max-width: 992px) {
      .sidebar {
        transform: translateX(-100%);
      }
      
      .sidebar.active {
        transform: translateX(0);
      }
      
      .main-content {
        margin-left: 0;
      }
      
      .main-header {
        left: 0;
      }
    }
    
    @media (max-width: 768px) {
      .form-row {
        flex-direction: column;
        gap: 0;
      }
      
      .page-header {
        flex-direction: column;
        align-items: flex-start;
        gap: 15px;
      }
      
      .page-actions {
        width: 100%;
        justify-content: flex-end;
      }
    }
    
    /* Animations */
    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }
    
    @keyframes slideUp {
      from { 
        opacity: 0;
        transform: translateY(20px);
      }
      to { 
        opacity: 1;
        transform: translateY(0);
      }
    }
    
    .fade-in {
      animation: fadeIn 0.5s ease forwards;
    }
    
    .slide-up {
      animation: slideUp 0.5s ease forwards;
    }
    
    /* Toast */
    .toastify {
      border-radius: 8px;
      font-family: 'Poppins', sans-serif;
      padding: 15px 20px;
    }
    
    /* Loading */
    .loading-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(255, 255, 255, 0.8);
      display: flex;
      justify-content: center;
      align-items: center;
      z-index: 2000;
    }
    
    .spinner {
      width: 50px;
      height: 50px;
      border: 5px solid var(--primary-light);
      border-top-color: var(--primary);
      border-radius: 50%;
      animation: spin 1s linear infinite;
    }
    
    @keyframes spin {
      to { transform: rotate(360deg); }
    }
  </style>
</head>
<body>
  <!-- Login Screen -->
  <div class="login-container" id="loginScreen">
    <div class="login-card" id="loginCard">
      <div class="login-logo">
        <i class="fas fa-hand-holding-usd"></i>
        <h1>MoneyTrack Pro</h1>
      </div>
      <form id="loginForm">
        <div class="form-group">
          <label for="username">Tên đăng nhập</label>
          <div class="input-group">
            <i class="fas fa-user input-icon"></i>
            <input type="text" id="username" class="form-control" placeholder="Nhập tên đăng nhập" required>
          </div>
        </div>
        <div class="form-group">
          <label for="password">Mật khẩu</label>
          <div class="input-group">
            <i class="fas fa-lock input-icon"></i>
            <input type="password" id="password" class="form-control" placeholder="Nhập mật khẩu" required>
          </div>
        </div>
        <button type="submit" class="btn btn-primary btn-block">
          <i class="fas fa-sign-in-alt"></i> Đăng nhập
        </button>
      </form>
    </div>
  </div>

  <!-- Main App -->
  <div class="app-container" id="appContainer">
    <!-- Sidebar -->
    <div class="sidebar" id="sidebar">
      <div class="sidebar-header">
        <div class="sidebar-logo">
          <i class="fas fa-hand-holding-usd"></i>
          <span>MoneyTrack</span>
        </div>
      </div>
      <div class="sidebar-menu">
        <a href="#" class="menu-item active" data-page="dashboard">
          <i class="fas fa-tachometer-alt"></i>
          <span>Dashboard</span>
        </a>
        <a href="#" class="menu-item" data-page="debts">
          <i class="fas fa-money-bill-wave"></i>
          <span>Quản lý nợ</span>
        </a>
        <a href="#" class="menu-item" data-page="reports">
          <i class="fas fa-chart-bar"></i>
          <span>Báo cáo</span>
        </a>
        <a href="#" class="menu-item" data-page="settings">
          <i class="fas fa-cog"></i>
          <span>Cài đặt</span>
        </a>
      </div>
    </div>

    <!-- Main Content -->
    <div class="main-content" id="mainContent">
      <!-- Header -->
      <div class="main-header">
        <div class="header-left">
          <button class="toggle-sidebar" id="toggleSidebar">
            <i class="fas fa-bars"></i>
          </button>
          <h2 id="pageTitle">Dashboard</h2>
        </div>
        <div class="header-right">
          <div class="user-dropdown">
            <button class="user-btn">
              <div class="user-avatar" id="userAvatar">A</div>
              <span class="user-name">Admin</span>
              <i class="fas fa-chevron-down"></i>
            </button>
            <div class="dropdown-menu">
              <a href="#" class="dropdown-item">
                <i class="fas fa-user mr-2"></i> Hồ sơ
              </a>
              <a href="#" class="dropdown-item">
                <i class="fas fa-cog mr-2"></i> Cài đặt
              </a>
              <div class="dropdown-divider"></div>
              <a href="#" class="dropdown-item" id="logoutBtn">
                <i class="fas fa-sign-out-alt mr-2"></i> Đăng xuất
              </a>
            </div>
          </div>
        </div>
      </div>

      <!-- Page Content -->
      <div class="page-content">
        <!-- Dashboard Page -->
        <div class="page" id="dashboardPage">
          <div class="page-header">
            <h3 class="page-title">Tổng quan</h3>
            <div class="page-actions">
              <button class="btn btn-primary">
                <i class="fas fa-plus"></i> Thêm nợ mới
              </button>
            </div>
          </div>
          
          <div class="stats-grid">
            <div class="stat-card primary">
              <div class="stat-title">
                <i class="fas fa-coins"></i>
                <span>Nợ phải thu</span>
              </div>
              <div class="stat-value" id="totalOwed">0 ₫</div>
              <div class="stat-change up">
                <i class="fas fa-arrow-up"></i>
                <span>5% so với tháng trước</span>
              </div>
            </div>
            
            <div class="stat-card danger">
              <div class="stat-title">
                <i class="fas fa-money-bill-wave"></i>
                <span>Nợ phải trả</span>
              </div>
              <div class="stat-value" id="totalOwing">0 ₫</div>
              <div class="stat-change down">
                <i class="fas fa-arrow-down"></i>
                <span>2% so với tháng trước</span>
              </div>
            </div>
            
            <div class="stat-card success">
              <div class="stat-title">
                <i class="fas fa-wallet"></i>
                <span>Tổng số dư</span>
              </div>
              <div class="stat-value" id="totalBalance">0 ₫</div>
              <div class="stat-change up">
                <i class="fas fa-arrow-up"></i>
                <span>10% so với tháng trước</span>
              </div>
            </div>
            
            <div class="stat-card warning">
              <div class="stat-title">
                <i class="fas fa-users"></i>
                <span>Tổng người nợ</span>
              </div>
              <div class="stat-value" id="totalPeople">0</div>
              <div class="stat-change up">
                <i class="fas fa-arrow-up"></i>
                <span>3 người mới</span>
              </div>
            </div>
          </div>
          
          <div class="chart-container">
            <div class="chart-header">
              <h3 class="chart-title">Biểu đồ nợ theo tháng</h3>
              <div class="chart-actions">
                <select class="form-control" id="chartRange" style="width: 150px;">
                  <option value="month">Theo tháng</option>
                  <option value="year">Theo năm</option>
                </select>
              </div>
            </div>
            <canvas id="debtChart" height="300"></canvas>
          </div>
          
          <div class="chart-container">
            <div class="chart-header">
              <h3 class="chart-title">Top 5 người nợ nhiều nhất</h3>
            </div>
            <canvas id="topDebtorsChart" height="300"></canvas>
          </div>
        </div>
        
        <!-- Debts Page -->
        <div class="page" id="debtsPage" style="display: none;">
          <div class="page-header">
            <h3 class="page-title">Quản lý nợ</h3>
            <div class="page-actions">
              <button class="btn btn-primary" id="addDebtBtn">
                <i class="fas fa-plus"></i> Thêm nợ mới
              </button>
              <button class="btn btn-outline" id="exportExcelBtn">
                <i class="fas fa-file-excel"></i> Xuất Excel
              </button>
            </div>
          </div>
          
          <div class="table-container">
            <div class="table-header">
              <h3 class="table-title">Danh sách nợ</h3>
              <div class="table-actions">
                <div class="input-group" style="width: 250px;">
                  <i class="fas fa-search input-icon"></i>
                  <input type="text" id="searchInput" class="form-control" placeholder="Tìm kiếm...">
                </div>
                <select class="form-control" id="filterStatus" style="width: 150px;">
                  <option value="all">Tất cả</option>
                  <option value="owed">Nợ phải thu</option>
                  <option value="owing">Nợ phải trả</option>
                </select>
              </div>
            </div>
            
            <div class="table-responsive">
              <table id="debtsTable">
                <thead>
                  <tr>
                    <th>Người nợ/cho nợ</th>
                    <th>Số tiền</th>
                    <th>Mô tả</th>
                    <th>Loại</th>
                    <th>Ngày tạo</th>
                    <th>Hành động</th>
                  </tr>
                </thead>
                <tbody id="debtsList">
                  <!-- Data will be loaded here -->
                </tbody>
              </table>
            </div>
          </div>
        </div>
        
        <!-- Reports Page -->
        <div class="page" id="reportsPage" style="display: none;">
          <div class="page-header">
            <h3 class="page-title">Báo cáo & Thống kê</h3>
            <div class="page-actions">
              <button class="btn btn-primary">
                <i class="fas fa-print"></i> In báo cáo
              </button>
            </div>
          </div>
          
          <div class="chart-container">
            <div class="chart-header">
              <h3 class="chart-title">Tổng quan nợ theo tháng</h3>
              <div class="chart-actions">
                <select class="form-control" id="reportYear" style="width: 120px;">
                  <option value="2023">2023</option>
                  <option value="2024">2024</option>
                  <option value="2025" selected>2025</option>
                </select>
              </div>
            </div>
            <canvas id="monthlyReportChart" height="300"></canvas>
          </div>
          
          <div class="row" style="display: flex; gap: 20px; margin-bottom: 30px;">
            <div class="chart-container" style="flex: 1;">
              <div class="chart-header">
                <h3 class="chart-title">Phân loại nợ</h3>
              </div>
              <canvas id="debtTypeChart" height="300"></canvas>
            </div>
            <div class="chart-container" style="flex: 1;">
              <div class="chart-header">
                <h3 class="chart-title">Tình trạng nợ</h3>
              </div>
              <canvas id="debtStatusChart" height="300"></canvas>
            </div>
          </div>
          
          <div class="table-container">
            <div class="table-header">
              <h3 class="table-title">Báo cáo chi tiết</h3>
              <div class="table-actions">
                <button class="btn btn-outline">
                  <i class="fas fa-filter"></i> Lọc
                </button>
              </div>
            </div>
            
            <div class="table-responsive">
              <table>
                <thead>
                  <tr>
                    <th>Tháng</th>
                    <th>Tổng nợ phải thu</th>
                    <th>Tổng nợ phải trả</th>
                    <th>Số dư</th>
                    <th>Số người nợ</th>
                    <th>Tỷ lệ tăng trưởng</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td>Tháng 1</td>
                    <td>15,000,000 ₫</td>
                    <td>5,000,000 ₫</td>
                    <td>10,000,000 ₫</td>
                    <td>8</td>
                    <td><span class="badge badge-success">+15%</span></td>
                  </tr>
                  <!-- More rows -->
                </tbody>
              </table>
            </div>
          </div>
        </div>
        
        <!-- Settings Page -->
        <div class="page" id="settingsPage" style="display: none;">
          <div class="page-header">
            <h3 class="page-title">Cài đặt hệ thống</h3>
          </div>
          
          <div class="card" style="background: white; border-radius: 12px; padding: 20px; margin-bottom: 30px;">
            <h4 style="margin-bottom: 20px; font-weight: 500;">Thông tin tài khoản</h4>
            
            <div class="form-row">
              <div class="form-col">
                <div class="form-group">
                  <label for="settingsUsername">Tên đăng nhập</label>
                  <input type="text" id="settingsUsername" class="form-control" value="tuquangnam" readonly>
                </div>
              </div>
              <div class="form-col">
                <div class="form-group">
                  <label for="settingsEmail">Email</label>
                  <input type="email" id="settingsEmail" class="form-control" value="tuquangnam@example.com">
                </div>
              </div>
            </div>
            
            <div class="form-group">
              <label for="settingsFullname">Họ và tên</label>
              <input type="text" id="settingsFullname" class="form-control" value="Tu Quang Nam">
            </div>
            
            <div class="form-group" style="text-align: right;">
              <button class="btn btn-primary">
                <i class="fas fa-save"></i> Lưu thay đổi
              </button>
            </div>
          </div>
          
          <div class="card" style="background: white; border-radius: 12px; padding: 20px; margin-bottom: 30px;">
            <h4 style="margin-bottom: 20px; font-weight: 500;">Đổi mật khẩu</h4>
            
            <div class="form-group">
              <label for="currentPassword">Mật khẩu hiện tại</label>
              <input type="password" id="currentPassword" class="form-control">
            </div>
            
            <div class="form-group">
              <label for="newPassword">Mật khẩu mới</label>
              <input type="password" id="newPassword" class="form-control">
            </div>
            
            <div class="form-group">
              <label for="confirmPassword">Xác nhận mật khẩu</label>
              <input type="password" id="confirmPassword" class="form-control">
            </div>
            
            <div class="form-group" style="text-align: right;">
              <button class="btn btn-primary">
                <i class="fas fa-key"></i> Đổi mật khẩu
              </button>
            </div>
          </div>
          
          <div class="card" style="background: white; border-radius: 12px; padding: 20px;">
            <h4 style="margin-bottom: 20px; font-weight: 500;">Cài đặt hệ thống</h4>
            
            <div class="form-group">
              <div class="switch-container">
                <span>Gửi thông báo qua email</span>
                <label class="switch">
                  <input type="checkbox" id="emailNotifications" checked>
                  <span class="slider"></span>
                </label>
              </div>
            </div>
            
            <div class="form-group">
              <div class="switch-container">
                <span>Nhắc nợ tự động</span>
                <label class="switch">
                  <input type="checkbox" id="autoReminder" checked>
                  <span class="slider"></span>
                </label>
              </div>
            </div>
            
            <div class="form-group">
              <label for="reminderDays">Số ngày nhắc nợ trước hạn</label>
              <select id="reminderDays" class="form-control">
                <option value="1">1 ngày</option>
                <option value="3" selected>3 ngày</option>
                <option value="7">7 ngày</option>
              </select>
            </div>
            
            <div class="form-group" style="text-align: right;">
              <button class="btn btn-primary">
                <i class="fas fa-save"></i> Lưu cài đặt
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Add/Edit Debt Modal -->
  <div class="modal" id="debtModal">
    <div class="modal-content">
      <div class="modal-header">
        <h3 class="modal-title" id="modalTitle">Thêm khoản nợ mới</h3>
        <button class="close-btn" id="closeModal">&times;</button>
      </div>
      <div class="modal-body">
        <form id="debtForm">
          <input type="hidden" id="debtId">
          <div class="form-row">
            <div class="form-col">
              <div class="form-group">
                <label for="person">Người nợ/cho nợ</label>
                <input type="text" id="person" class="form-control" required>
              </div>
            </div>
            <div class="form-col">
              <div class="form-group">
                <label for="amount">Số tiền (₫)</label>
                <input type="number" id="amount" class="form-control" required>
              </div>
            </div>
          </div>
          
          <div class="form-group">
            <label for="description">Mô tả (không bắt buộc)</label>
            <textarea id="description" class="form-control" rows="3"></textarea>
          </div>
          
          <div class="form-row">
            <div class="form-col">
              <div class="form-group">
                <label for="date">Ngày tạo</label>
                <input type="date" id="date" class="form-control">
              </div>
            </div>
            <div class="form-col">
              <div class="form-group">
                <label for="dueDate">Hạn trả</label>
                <input type="date" id="dueDate" class="form-control">
              </div>
            </div>
          </div>
          
          <div class="switch-container">
            <span id="switchLabel">Mình nợ họ</span>
            <label class="switch">
              <input type="checkbox" id="isOwed">
              <span class="slider"></span>
            </label>
            <span>Họ nợ mình</span>
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <button class="btn btn-outline" id="cancelModal">Hủy bỏ</button>
        <button class="btn btn-primary" id="saveDebtBtn">Lưu khoản nợ</button>
      </div>
    </div>
  </div>

  <!-- Loading Overlay -->
  <div class="loading-overlay" id="loadingOverlay" style="display: none;">
    <div class="spinner"></div>
  </div>

  <!-- Scripts -->
  <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/toastify-js"></script>
  <script>
    // API Configuration
    const API_URL = 'https://debt-api.tuquangnamht2007.workers.dev';
    const AUTH_USER = 'tuquangnam';
    const AUTH_PASS = 'admin123';
    
    // App State
    let debts = [];
    let currentPage = 'dashboard';
    let currentFilter = 'all';
    let currentSearch = '';
    let isEditing = false;
    let debtChart, topDebtorsChart, monthlyReportChart, debtTypeChart, debtStatusChart;
    
    // DOM Elements
    const loginScreen = document.getElementById('loginScreen');
    const loginCard = document.getElementById('loginCard');
    const loginForm = document.getElementById('loginForm');
    const appContainer = document.getElementById('appContainer');
    const sidebar = document.getElementById('sidebar');
    const toggleSidebar = document.getElementById('toggleSidebar');
    const mainContent = document.getElementById('mainContent');
    const pageTitle = document.getElementById('pageTitle');
    const logoutBtn = document.getElementById('logoutBtn');
    const userAvatar = document.getElementById('userAvatar');
    
    // Pages
    const pages = {
      dashboard: document.getElementById('dashboardPage'),
      debts: document.getElementById('debtsPage'),
      reports: document.getElementById('reportsPage'),
      settings: document.getElementById('settingsPage')
    };
    
    // Menu Items
    const menuItems = document.querySelectorAll('.menu-item');
    
    // Debt Elements
    const debtsList = document.getElementById('debtsList');
    const debtModal = document.getElementById('debtModal');
    const debtForm = document.getElementById('debtForm');
    const addDebtBtn = document.getElementById('addDebtBtn');
    const closeModal = document.getElementById('closeModal');
    const cancelModal = document.getElementById('cancelModal');
    const saveDebtBtn = document.getElementById('saveDebtBtn');
    const searchInput = document.getElementById('searchInput');
    const filterStatus = document.getElementById('filterStatus');
    const exportExcelBtn = document.getElementById('exportExcelBtn');
    
    // Stats Elements
    const totalOwed = document.getElementById('totalOwed');
    const totalOwing = document.getElementById('totalOwing');
    const totalBalance = document.getElementById('totalBalance');
    const totalPeople = document.getElementById('totalPeople');
    
    // Format currency
    const formatCurrency = (amount) => {
      return new Intl.NumberFormat('vi-VN', { 
        style: 'currency', 
        currency: 'VND' 
      }).format(amount);
    };
    
    // Format date
    const formatDate = (dateString) => {
      if (!dateString) return '';
      const options = { 
        year: 'numeric', 
        month: 'short', 
        day: 'numeric',
        hour: '2-digit',
        minute: '2-digit'
      };
      return new Date(dateString).toLocaleDateString('vi-VN', options);
    };
    
    // Show loading
    const showLoading = () => {
      document.getElementById('loadingOverlay').style.display = 'flex';
    };
    
    // Hide loading
    const hideLoading = () => {
      document.getElementById('loadingOverlay').style.display = 'none';
    };
    
    // Show toast message
    const showToast = (message, type = 'success') => {
      let background = 'linear-gradient(to right, #00b09b, #96c93d)';
      if (type === 'error') background = 'linear-gradient(to right, #ff416c, #ff4b2b)';
      if (type === 'warning') background = 'linear-gradient(to right, #f46b45, #eea849)';
      if (type === 'info') background = 'linear-gradient(to right, #4b6cb7, #182848)';
      
      Toastify({
        text: message,
        duration: 3000,
        close: true,
        gravity: "top",
        position: "right",
        backgroundColor: background,
        stopOnFocus: true,
      }).showToast();
    };
    
    // Initialize charts
    const initCharts = () => {
      // Debt Chart
      const debtCtx = document.getElementById('debtChart').getContext('2d');
      debtChart = new Chart(debtCtx, {
        type: 'line',
        data: {
          labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul'],
          datasets: [
            {
              label: 'Nợ phải thu',
              data: [12000000, 19000000, 15000000, 18000000, 22000000, 21000000, 25000000],
              borderColor: '#4cc9f0',
              backgroundColor: 'rgba(76, 201, 240, 0.1)',
              tension: 0.3,
              fill: true
            },
            {
              label: 'Nợ phải trả',
              data: [5000000, 7000000, 6000000, 8000000, 9000000, 10000000, 12000000],
              borderColor: '#f72585',
              backgroundColor: 'rgba(247, 37, 133, 0.1)',
              tension: 0.3,
              fill: true
            }
          ]
        },
        options: {
          responsive: true,
          plugins: {
            legend: {
              position: 'top',
            },
            tooltip: {
              callbacks: {
                label: function(context) {
                  let label = context.dataset.label || '';
                  if (label) label += ': ';
                  label += formatCurrency(context.raw);
                  return label;
                }
              }
            }
          },
          scales: {
            y: {
              beginAtZero: true,
              ticks: {
                callback: function(value) {
                  return formatCurrency(value);
                }
              }
            }
          }
        }
      });
      
      // Top Debtors Chart
      const topDebtorsCtx = document.getElementById('topDebtorsChart').getContext('2d');
      topDebtorsChart = new Chart(topDebtorsCtx, {
        type: 'bar',
        data: {
          labels: ['Người A', 'Người B', 'Người C', 'Người D', 'Người E'],
          datasets: [{
            label: 'Số tiền nợ',
            data: [8000000, 6000000, 4500000, 3500000, 3000000],
            backgroundColor: [
              'rgba(67, 97, 238, 0.7)',
              'rgba(76, 201, 240, 0.7)',
              'rgba(72, 149, 239, 0.7)',
              'rgba(248, 150, 30, 0.7)',
              'rgba(247, 37, 133, 0.7)'
            ],
            borderColor: [
              'rgba(67, 97, 238, 1)',
              'rgba(76, 201, 240, 1)',
              'rgba(72, 149, 239, 1)',
              'rgba(248, 150, 30, 1)',
              'rgba(247, 37, 133, 1)'
            ],
            borderWidth: 1
          }]
        },
        options: {
          responsive: true,
          plugins: {
            legend: {
              display: false
            },
            tooltip: {
              callbacks: {
                label: function(context) {
                  return formatCurrency(context.raw);
                }
              }
            }
          },
          scales: {
            y: {
              beginAtZero: true,
              ticks: {
                callback: function(value) {
                  return formatCurrency(value);
                }
              }
            }
          }
        }
      });
      
      // Monthly Report Chart
      const monthlyReportCtx = document.getElementById('monthlyReportChart').getContext('2d');
      monthlyReportChart = new Chart(monthlyReportCtx, {
        type: 'bar',
        data: {
          labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'],
          datasets: [
            {
              label: 'Nợ phải thu',
              data: [15000000, 19000000, 18000000, 21000000, 23000000, 25000000, 27000000, 26000000, 24000000, 22000000, 20000000, 18000000],
              backgroundColor: 'rgba(76, 201, 240, 0.7)',
              borderColor: 'rgba(76, 201, 240, 1)',
              borderWidth: 1
            },
            {
              label: 'Nợ phải trả',
              data: [5000000, 7000000, 6000000, 8000000, 9000000, 10000000, 12000000, 11000000, 9000000, 8000000, 7000000, 6000000],
              backgroundColor: 'rgba(247, 37, 133, 0.7)',
              borderColor: 'rgba(247, 37, 133, 1)',
              borderWidth: 1
            }
          ]
        },
        options: {
          responsive: true,
          plugins: {
            legend: {
              position: 'top',
            },
            tooltip: {
              callbacks: {
                label: function(context) {
                  let label = context.dataset.label || '';
                  if (label) label += ': ';
                  label += formatCurrency(context.raw);
                  return label;
                }
              }
            }
          },
          scales: {
            y: {
              beginAtZero: true,
              ticks: {
                callback: function(value) {
                  return formatCurrency(value);
                }
              }
            }
          }
        }
      });
      
      // Debt Type Chart
      const debtTypeCtx = document.getElementById('debtTypeChart').getContext('2d');
      debtTypeChart = new Chart(debtTypeCtx, {
        type: 'doughnut',
        data: {
          labels: ['Nợ kinh doanh', 'Nợ cá nhân', 'Nợ gia đình', 'Nợ khác'],
          datasets: [{
            data: [35, 30, 25, 10],
            backgroundColor: [
              'rgba(67, 97, 238, 0.7)',
              'rgba(76, 201, 240, 0.7)',
              'rgba(72, 149, 239, 0.7)',
              'rgba(248, 150, 30, 0.7)'
            ],
            borderColor: [
              'rgba(67, 97, 238, 1)',
              'rgba(76, 201, 240, 1)',
              'rgba(72, 149, 239, 1)',
              'rgba(248, 150, 30, 1)'
            ],
            borderWidth: 1
          }]
        },
        options: {
          responsive: true,
          plugins: {
            legend: {
              position: 'right',
            },
            tooltip: {
              callbacks: {
                label: function(context) {
                  const label = context.label || '';
                  const value = context.raw || 0;
                  const total = context.dataset.data.reduce((a, b) => a + b, 0);
                  const percentage = Math.round((value / total) * 100);
                  return `${label}: ${percentage}% (${formatCurrency(value * 100000)})`;
                }
              }
            }
          }
        }
      });
      
      // Debt Status Chart
      const debtStatusCtx = document.getElementById('debtStatusChart').getContext('2d');
      debtStatusChart = new Chart(debtStatusCtx, {
        type: 'pie',
        data: {
          labels: ['Đã trả', 'Đến hạn', 'Quá hạn', 'Chưa đến hạn'],
          datasets: [{
            data: [25, 15, 10, 50],
            backgroundColor: [
              'rgba(76, 201, 240, 0.7)',
              'rgba(248, 150, 30, 0.7)',
              'rgba(247, 37, 133, 0.7)',
              'rgba(67, 97, 238, 0.7)'
            ],
            borderColor: [
              'rgba(76, 201, 240, 1)',
              'rgba(248, 150, 30, 1)',
              'rgba(247, 37, 133, 1)',
              'rgba(67, 97, 238, 1)'
            ],
            borderWidth: 1
          }]
        },
        options: {
          responsive: true,
          plugins: {
            legend: {
              position: 'right',
            },
            tooltip: {
              callbacks: {
                label: function(context) {
                  const label = context.label || '';
                  const value = context.raw || 0;
                  return `${label}: ${value}%`;
                }
              }
            }
          }
        }
      });
    };
    
    // Fetch all debts
    const fetchDebts = async () => {
      showLoading();
      try {
        const response = await axios.get(`${API_URL}/api/debts`);
        debts = response.data;
        renderDebts();
        updateStats();
      } catch (error) {
        console.error('Error fetching debts:', error);
        showToast('Có lỗi khi tải danh sách nợ', 'error');
      } finally {
        hideLoading();
      }
    };
    
    // Add new debt
    const addDebt = async (debtData) => {
      showLoading();
      try {
        await axios.post(`${API_URL}/api/debts`, debtData);
        showToast('Thêm khoản nợ thành công');
        fetchDebts();
        closeDebtModal();
      } catch (error) {
        console.error('Error adding debt:', error);
        showToast('Có lỗi khi thêm khoản nợ', 'error');
      } finally {
        hideLoading();
      }
    };
    
    // Delete debt
    const deleteDebt = async (id) => {
      if (!confirm('Bạn có chắc chắn muốn xóa khoản nợ này?')) return;
      
      showLoading();
      try {
        await axios.delete(`${API_URL}/api/debts/${id}`);
        showToast('Xóa khoản nợ thành công');
        fetchDebts();
      } catch (error) {
        console.error('Error deleting debt:', error);
        showToast('Có lỗi khi xóa khoản nợ', 'error');
      } finally {
        hideLoading();
      }
    };
    
    // Update stats
    const updateStats = () => {
      const owedDebts = debts.filter(debt => debt.is_owed);
      const owingDebts = debts.filter(debt => !debt.is_owed);
      
      const totalOwedAmount = owedDebts.reduce((sum, debt) => sum + parseFloat(debt.amount), 0);
      const totalOwingAmount = owingDebts.reduce((sum, debt) => sum + parseFloat(debt.amount), 0);
      const balance = totalOwedAmount - totalOwingAmount;
      
      totalOwed.textContent = formatCurrency(totalOwedAmount);
      totalOwing.textContent = formatCurrency(totalOwingAmount);
      totalBalance.textContent = formatCurrency(balance);
      
      // Count unique people
      const people = new Set();
      debts.forEach(debt => people.add(debt.person));
      totalPeople.textContent = people.size;
      
      // Update chart data
      if (debtChart) {
        debtChart.data.datasets[0].data = [totalOwedAmount * 0.8, totalOwedAmount * 0.9, totalOwedAmount];
        debtChart.data.datasets[1].data = [totalOwingAmount * 0.8, totalOwingAmount * 0.9, totalOwingAmount];
        debtChart.update();
      }
    };
    
    // Render debts list
    const renderDebts = () => {
      if (debts.length === 0) {
        debtsList.innerHTML = `
          <tr>
            <td colspan="6" style="text-align: center; padding: 30px;">
              <i class="fas fa-coins" style="font-size: 2rem; color: #e0e0e0; margin-bottom: 15px;"></i>
              <h3 style="color: var(--gray);">Không có khoản nợ nào</h3>
              <p>Nhấn nút "Thêm nợ mới" để bắt đầu</p>
            </td>
          </tr>
        `;
        return;
      }
      
      // Filter debts based on current filter and search
      let filteredDebts = debts;
      
      if (currentFilter === 'owed') {
        filteredDebts = filteredDebts.filter(debt => debt.is_owed);
      } else if (currentFilter === 'owing') {
        filteredDebts = filteredDebts.filter(debt => !debt.is_owed);
      }
      
      if (currentSearch) {
        const searchTerm = currentSearch.toLowerCase();
        filteredDebts = filteredDebts.filter(debt => 
          debt.person.toLowerCase().includes(searchTerm) || 
          (debt.description && debt.description.toLowerCase().includes(searchTerm))
        );
      }
      
      if (filteredDebts.length === 0) {
        debtsList.innerHTML = `
          <tr>
            <td colspan="6" style="text-align: center; padding: 30px;">
              <i class="fas fa-search" style="font-size: 2rem; color: #e0e0e0; margin-bottom: 15px;"></i>
              <h3 style="color: var(--gray);">Không tìm thấy kết quả</h3>
              <p>Thử thay đổi tiêu chí tìm kiếm hoặc bộ lọc</p>
            </td>
          </tr>
        `;
        return;
      }
      
      debtsList.innerHTML = filteredDebts.map(debt => `
        <tr>
          <td>${debt.person}</td>
          <td>${formatCurrency(parseFloat(debt.amount))}</td>
          <td>${debt.description || '-'}</td>
          <td>
            <span class="badge ${debt.is_owed ? 'badge-success' : 'badge-danger'}">
              ${debt.is_owed ? 'Nợ phải thu' : 'Nợ phải trả'}
            </span>
          </td>
          <td>${formatDate(debt.created_at)}</td>
          <td>
            <button class="action-btn edit" data-id="${debt.id}">
              <i class="fas fa-edit"></i>
            </button>
            <button class="action-btn delete" data-id="${debt.id}">
              <i class="fas fa-trash"></i>
            </button>
          </td>
        </tr>
      `).join('');
      
      // Add event listeners to action buttons
      document.querySelectorAll('.action-btn.delete').forEach(btn => {
        btn.addEventListener('click', (e) => {
          e.stopPropagation();
          deleteDebt(btn.dataset.id);
        });
      });
      
      document.querySelectorAll('.action-btn.edit').forEach(btn => {
        btn.addEventListener('click', (e) => {
          e.stopPropagation();
          editDebt(btn.dataset.id);
        });
      });
    };
    
    // Open debt modal for adding
    const openAddDebtModal = () => {
      isEditing = false;
      document.getElementById('modalTitle').textContent = 'Thêm khoản nợ mới';
      debtForm.reset();
      document.getElementById('isOwed').checked = true;
      updateSwitchLabels();
      debtModal.classList.add('active');
    };
    
    // Open debt modal for editing
    const editDebt = (id) => {
      const debt = debts.find(d => d.id == id);
      if (!debt) return;
      
      isEditing = true;
      document.getElementById('modalTitle').textContent = 'Chỉnh sửa khoản nợ';
      document.getElementById('debtId').value = debt.id;
      document.getElementById('person').value = debt.person;
      document.getElementById('amount').value = debt.amount;
      document.getElementById('description').value = debt.description || '';
      document.getElementById('isOwed').checked = debt.is_owed;
      updateSwitchLabels();
      debtModal.classList.add('active');
    };
    
    // Close debt modal
    const closeDebtModal = () => {
      debtModal.classList.remove('active');
    };
    
    // Update switch labels
    const updateSwitchLabels = () => {
      const isOwed = document.getElementById('isOwed').checked;
      document.getElementById('switchLabel').textContent = isOwed ? 'Họ nợ mình' : 'Mình nợ họ';
    };
    
    // Export to Excel
    const exportToExcel = () => {
      const data = debts.map(debt => ({
        'Người nợ/cho nợ': debt.person,
        'Số tiền': debt.amount,
        'Mô tả': debt.description || '',
        'Loại': debt.is_owed ? 'Nợ phải thu' : 'Nợ phải trả',
        'Ngày tạo': formatDate(debt.created_at)
      }));
      
      const worksheet = XLSX.utils.json_to_sheet(data);
      const workbook = XLSX.utils.book_new();
      XLSX.utils.book_append_sheet(workbook, worksheet, 'Danh sách nợ');
      XLSX.writeFile(workbook, 'danh_sach_no.xlsx');
      
      showToast('Xuất file Excel thành công');
    };
    
    // Change page
    const changePage = (page) => {
      currentPage = page;
      pageTitle.textContent = document.querySelector(`.menu-item[data-page="${page}"] span`).textContent;
      
      // Hide all pages
      Object.values(pages).forEach(p => p.style.display = 'none');
      
      // Show current page
      pages[page].style.display = 'block';
      
      // Update active menu item
      menuItems.forEach(item => {
        if (item.dataset.page === page) {
          item.classList.add('active');
        } else {
          item.classList.remove('active');
        }
      });
    };
    
    // Login function
    const login = (username, password) => {
      if (username === AUTH_USER && password === AUTH_PASS) {
        // Simulate loading
        showLoading();
        
        // Hide login card
        loginCard.classList.add('hidden');
        
        setTimeout(() => {
          // Hide login screen
          loginScreen.style.display = 'none';
          
          // Show app container
          appContainer.classList.add('active');
          
          // Set user avatar
          userAvatar.textContent = username.charAt(0).toUpperCase();
          
          // Initialize charts
          initCharts();
          
          // Load data
          fetchDebts();
          
          hideLoading();
        }, 1000);
        
        return true;
      } else {
        showToast('Tên đăng nhập hoặc mật khẩu không đúng', 'error');
        return false;
      }
    };
    
    // Logout function
    const logout = () => {
      showLoading();
      
      // Hide app container
      appContainer.classList.remove('active');
      
      setTimeout(() => {
        // Show login screen
        loginScreen.style.display = 'flex';
        loginCard.classList.remove('hidden');
        
        // Reset form
        loginForm.reset();
        
        hideLoading();
      }, 800);
    };
    
    // Event Listeners
    loginForm.addEventListener('submit', (e) => {
      e.preventDefault();
      const username = document.getElementById('username').value.trim();
      const password = document.getElementById('password').value;
      
      login(username, password);
    });
    
    addDebtBtn.addEventListener('click', openAddDebtModal);
    closeModal.addEventListener('click', closeDebtModal);
    cancelModal.addEventListener('click', closeDebtModal);
    
    debtForm.addEventListener('submit', (e) => {
      e.preventDefault();
      
      const debtData = {
        person: document.getElementById('person').value.trim(),
        amount: parseFloat(document.getElementById('amount').value),
        description: document.getElementById('description').value.trim(),
        is_owed: document.getElementById('isOwed').checked
      };
      
      if (!debtData.person || isNaN(debtData.amount)) {
        showToast('Vui lòng điền đầy đủ thông tin', 'error');
        return;
      }
      
      addDebt(debtData);
    });
    
    searchInput.addEventListener('input', (e) => {
      currentSearch = e.target.value.trim();
      renderDebts();
    });
    
    filterStatus.addEventListener('change', (e) => {
      currentFilter = e.target.value;
      renderDebts();
    });
    
    exportExcelBtn.addEventListener('click', exportToExcel);
    
    document.getElementById('isOwed').addEventListener('change', updateSwitchLabels);
    
    // Menu item clicks
    menuItems.forEach(item => {
      item.addEventListener('click', (e) => {
        e.preventDefault();
        changePage(item.dataset.page);
      });
    });
    
    // Toggle sidebar
    toggleSidebar.addEventListener('click', () => {
      sidebar.classList.toggle('active');
      mainContent.style.marginLeft = sidebar.classList.contains('active') ? '0' : 'var(--sidebar-width)';
    });
    
    // Logout
    logoutBtn.addEventListener('click', (e) => {
      e.preventDefault();
      logout();
    });
    
    // Close modal when clicking outside
    debtModal.addEventListener('click', (e) => {
      if (e.target === debtModal) {
        closeDebtModal();
      }
    });
    
    // Initialize app
    document.addEventListener('DOMContentLoaded', () => {
      // Set current year in reports
      const currentYear = new Date().getFullYear();
      const yearSelect = document.getElementById('reportYear');
      if (!Array.from(yearSelect.options).some(opt => opt.value === currentYear.toString())) {
        const option = document.createElement('option');
        option.value = currentYear;
        option.textContent = currentYear;
        yearSelect.appendChild(option);
      }
      yearSelect.value = currentYear;
    });
  </script>
</body>
</html>
